openapi: 3.0.3
info:
  title: sacom auth-svc (independent)
  version: 1.0.0
servers:
  - url: http://localhost:4443
tags:
  - name: Health
  - name: Auth
  - name: Sessions
  - name: Users
  - name: Roles
  - name: Permissions
paths:
  /health:
    get:
      tags: [Health]
      summary: Health check
      responses:
        '200':
          description: OK
  /auth/login:
    post:
      tags: [Auth]
      summary: Login and issue access token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string, format: email }
                password: { type: string }
      responses:
        '200':
          description: Logged in
  /auth/refresh:
    post:
      tags: [Auth]
      summary: Refresh access token using refresh cookie
      responses:
        '200': { description: Refreshed }
        '401': { description: Unauthorized }
  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout and clear refresh cookie
      responses:
        '200': { description: Logged out }
  /api/me:
    get:
      tags: [Auth]
      summary: Current authenticated user profile + permissions
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Me payload }
        '401': { description: Unauthorized }
  /auth/session:
    get:
      tags: [Sessions]
      summary: List sessions for current user
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Session list }
  /auth/session/deleteSession:
    delete:
      tags: [Sessions]
      summary: Delete one session
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [sessionId]
              properties:
                sessionId: { type: string }
      responses:
        '200': { description: Deleted }
  /auth/session/deleteAllSessions:
    delete:
      tags: [Sessions]
      summary: Delete all sessions for current user
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Deleted all }
  /api/admin/users:
    get:
      tags: [Users]
      summary: List users
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: User list }
    post:
      tags: [Users]
      summary: Create user
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '201': { description: Created }
  /api/admin/users/{id}:
    parameters:
      - in: path
        name: id
        required: true
        schema: { type: string }
    get:
      tags: [Users]
      summary: Get user by id
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: User }
    put:
      tags: [Users]
      summary: Update user
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200': { description: Updated }
    delete:
      tags: [Users]
      summary: Delete user
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Deleted }
  /api/admin/roles:
    get:
      tags: [Roles]
      summary: List roles
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Role list }
    post:
      tags: [Roles]
      summary: Create role
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '201': { description: Created }
  /api/admin/roles/{id}:
    parameters:
      - in: path
        name: id
        required: true
        schema: { type: string }
    put:
      tags: [Roles]
      summary: Update role
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200': { description: Updated }
    delete:
      tags: [Roles]
      summary: Delete role
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Deleted }
  /api/admin/permissions:
    get:
      tags: [Permissions]
      summary: List permissions
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Permission list }
    post:
      tags: [Permissions]
      summary: Create permission
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '201': { description: Created }
    put:
      tags: [Permissions]
      summary: Update permission (bulk/route-defined)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { type: object }
      responses:
        '200': { description: Updated }
  /api/admin/permissions/{id}:
    parameters:
      - in: path
        name: id
        required: true
        schema: { type: string }
    delete:
      tags: [Permissions]
      summary: Delete permission
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: Deleted }
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
